# 📋 モックアップアプリ実装タスクリスト

## プロジェクトの現在地
- ✅ **実装済み**: 単一デバイスの白領域検出・塗りつぶし機能（MinimalMockup.tsx）
- ❌ **未実装**: 複数デバイス同時処理、プリセットギャラリー、ドロップゾーンUI、出力サイズ調整など

---

## 🚨 **最重要＆爆速対応**
> これらのタスクは、アプリの基本機能を成立させるために絶対必要

### 1. 複数デバイス同時塗りつぶし対応
**現状の問題**: 複数デバイスがあるフレームで1つしか塗りつぶしができない

- このタスク1全体については、以下2つの画像をサンプルとして使用し、複数デバイス識別、塗りつぶし処理を的確に実装すること。
  - `public/assets/mockup/9x16/SpAndLaptop_9x16_028_brown.webp` 
  - `public/assets/mockup/16x9/2SpAndLaptop_16x9_037_blue.webp`

#### 1-1. デバイス領域の状態管理を複数対応に改修
- [ ] MinimalMockup.tsx の state を配列管理に変更
  - `customRectPct` → `customRectPcts: ScreenRectPct[]`
  - `maskDataUrl` → `maskDataUrls: string[]`
  - `compositeUrl` → `compositeUrls: string[]`
- [ ] 各デバイスごとに独立したマスク・合成データを保持
- [ ] クリック時に該当デバイスのインデックスを特定する処理追加

#### 1-2. 複数デバイス識別カラーシステムの実装
- [x] `src/constants/deviceColors.ts` を作成
  ```typescript
  export const DEVICE_FILL_COLORS = {
    primary: '#e5c4be',    // 1台目
    secondary: '#accbde',  // 2台目
    tertiary: '#ffe2c6',   // 3台目
  };
  ```
- [x] 各デバイスに対応する色を自動割り当て
- [x] オーバーレイ描画時にデバイスごとの色を適用

#### 1-3. 複数画像アップロード対応
- [x] アップロード画像を配列で管理（最大3枚）
- [x] 各デバイスに対応する画像を個別に設定可能に
- [ ] 画像削除・変更機能を各デバイスごとに実装

---

### 2. 出力サイズ調整機能の実装
**必須要件**: 6種類のアスペクト比での出力対応

#### 2-1. 出力サイズ定数の定義
- [ ] `src/constants/outputSizes.ts` を作成
- [ ] 6種類のアスペクト比と対応するピクセルサイズを定義
- [ ] TypeScript型定義を追加

#### 2-2. 最終合成Canvas処理の実装
- [ ] 選択されたアスペクト比に基づいて出力Canvasサイズを設定
- [ ] フレーム画像と合成結果を指定サイズにリサイズ
- [ ] 高品質な補間処理（`imageSmoothingQuality: 'high'`）

#### 2-3. ダウンロード機能の実装
- [ ] `src/utils/mobileFeatures.ts` を作成
- [ ] クロスプラットフォーム対応の`saveImageToDevice()`実装
- [ ] iOS Safari/Android Chrome/WebViewでの動作確認

---

## 🔥 **やや急ぎ、重要度高め**
> 基本機能を補完し、ユーザビリティを向上させるタスク

### 3. 黒フレーム囲み自動検出アルゴリズムの実装
**目的**: 背景が明るい画像でも正確に画面領域を検出

#### 3-1. ベゼル検出アルゴリズムの実装
- [ ] `src/utils/screenDetection.ts` を作成
- [ ] `detectDeviceScreens()` 関数の実装
  - 輝度閾値での白領域候補抽出
  - BFS連結成分抽出
  - ベゼルスコア計算（黒フレーム囲みチェック）
  - 最大3領域の自動検出
- [ ] パラメータ調整用のオプション引数追加

#### 3-2. 既存コードとの統合
- [ ] MinimalMockup.tsx のクリック検出を自動検出に置き換え
- [ ] 自動検出結果の視覚的フィードバック追加
- [ ] 検出失敗時の手動選択フォールバック

---

### 4. プリセットギャラリーの実装
**目的**: ユーザーが簡単にフレームを選択できるUI

#### 4-1. フィルタリング機能の実装
- [ ] 選択できるフレームのディレクトリを'public/assets/frames'を'public/assets/mockup'以下に変更する。
- [ ] `src/hooks/usePresetFilter.ts` を作成し、各ディレクトリ内の画像ファイルごとにフィルターを作成する
- [ ] アスペクト比フィルタ
  - [ ] 1:1
  - [ ] 4:5
  - [ ] 9:16
  - [ ] 16:9
- [ ] デバイス種類フィルタ（SmartPhone/Laptop/Tablet/Mixed）
  - [ ] Mixed:SpAndLaptop、2SpAndLaptop、2spのようにファイル名に記載されているもの
- [ ] カラートーンフィルタ

#### 4-2. ギャラリーコンポーネントの実装
- [ ] `src/components/PresetGallery.tsx` を作成
- [ ] グリッドレイアウトでのサムネイル表示
- [ ] クリック/タップで選択可能なUI
- [ ] 選択状態の視覚的フィードバック



---

## ⚡ **優先度は低いけど、なる早で処理したい**
> UX向上と完成度を高めるためのタスク

### 5. インタラクティブドロップゾーンUI
**目的**: 各デバイス領域に直接ドラッグ&ドロップで画像追加

#### 5-1. DropZoneOverlayコンポーネントの作成
- [ ] `src/components/DropZoneOverlay.tsx` を作成
- [ ] ドラッグ&ドロップのイベント処理
- [ ] クリックでファイル選択ダイアログ表示
- [ ] アップロード中のローディング表示

#### 5-2. ドロップゾーンの視覚的フィードバック
- [ ] ホバー/ドラッグオーバー時のハイライト
- [ ] デバイス番号バッジの表示
- [ ] アップロード済み画像のプレビュー表示
- [ ] 画像削除ボタンの追加

#### 5-3. モバイル対応の最適化
- [ ] タッチターゲット44px以上の確保
- [ ] タップでのファイル選択対応
- [ ] スワイプジェスチャーでの画像変更（オプション）

---



### 7. モバイルセーフエリア対応
**目的**: ノッチ付きデバイスでの適切な表示

#### 7-1. セーフエリアのCSS実装
- [ ] `env(safe-area-inset-*)` の適用
- [ ] Tailwind設定への追加
- [ ] 全画面レイアウトの調整

#### 7-2. レスポンシブ対応の強化
- [ ] 375px〜430pxでの最適化
- [ ] タブレット対応（768px〜）
- [ ] デスクトップ表示の改善

---

## 💤 **余裕ができたらやろう**
> nice-to-have な機能追加

### 8. AIテンプレート生成機能（背景生成を除く）
- [ ] カスタムフレーム生成UIの追加
- [ ] 生成結果のプレビュー機能

### 9. アニメーション・エフェクト
- [ ] Framer Motion を使った滑らかなトランジション
- [ ] 画像アップロード時のフェードイン効果
- [ ] デバイス選択時のハイライトアニメーション

### 10. パフォーマンス最適化
- [ ] 大きな画像の自動リサイズ処理
- [ ] Canvas処理のWeb Worker化
- [ ] メモリリークの防止（useEffect cleanup）

### 11. エラーハンドリングの強化
- [ ] ユーザーフレンドリーなエラーメッセージ
- [ ] 画像フォーマットバリデーション
- [ ] アップロードサイズ制限の実装

---

## 📊 実装進捗チェックリスト

### Phase 1: 最低限動作するMVP（最重要タスク）
- [ ] 複数デバイス同時処理
- [ ] 6種類の出力サイズ対応
- [ ] 基本的なダウンロード機能

### Phase 2: 実用的なアプリ（重要度高め）
- [ ] 黒フレーム自動検出
- [ ] プリセットギャラリー
- [ ] フィルタリング機能

### Phase 3: 完成度の高いアプリ（優先度低め）
- [ ] ドロップゾーンUI
- [ ] モバイル最適化

### Phase 4: プロダクションレベル（余裕があれば）
- [ ] AIカスタマイズ
- [ ] アニメーション
- [ ] パフォーマンス最適化

---

## 🛠️ 開発の進め方

1. **最重要タスクから順番に実装**
   - まず複数デバイス対応を完成させる
   - 次に出力サイズ調整を実装
   - 最低限のMVPを動作させる

2. **各タスク完了後は必ずビルド確認**
   ```bash
   npm run build
   ```
   - エラーが出たら即修正
   - YouWareのゼロトレランス方針を遵守

3. **段階的なテスト**
   - 各機能実装後に動作確認
   - モバイル実機でのテスト
   - 複数ブラウザでの互換性確認

4. **コードの整理とリファクタリング**
   - 共通処理のユーティリティ化
   - TypeScript型の適切な定義
   - コメントとドキュメントの追加

---

## 📝 注意事項

- **Canvas APIのみで画像処理を実装**（サーバーサイド処理は使用不可）
- **絶対パスでアセット参照**（`/assets/...`）
- **モバイルファーストで設計**
- **テキストの明瞭性を最優先**（AIによる再描画は避ける）
- **メモリ管理を意識**（大きな画像データの適切な破棄）

---

最終更新: 2024年2025/11/27 10:33